!function(){"use strict";function e(e){return JSON.stringify(e,((e,t)=>-1!==["custom_matches","p","s"].indexOf(e)&&null!==t&&"object"==typeof t?"||"+JSON.stringify(t)+"||":t),1).replace(/"(.*?)":/g,'<span class="json-key">$1:</span>').replace(/,([\d,[])/g,", $1").replace(/"\|\|/g,"").replace(/\|\|"/g,"")}function t(e){e=Object.assign({},{num_iscritti:0},e);let t={num_rounds:Math.ceil(Math.log2(e.num_iscritti)),num_players:0,matches_round1:0,num_bye:0};return t.num_players=Math.pow(2,t.num_rounds),t.matches_round1=t.num_players/2,t.num_bye=t.num_players-e.num_iscritti,t}function n(e,t){let n={child_match:Math.ceil(e.m/2)+t.matches_round1,next_round:e.r+1};return n.next_round>t.num_rounds&&(n={child_match:null,next_round:null}),n}var r=(e,t)=>{let n;switch(t-e){case 0:n="Finale";break;case 1:n="Semifinale";break;case 2:n="Quarti di finale";break;case 3:n="Ottavi di finale";break;default:n=""}return n};function o(e){let t={};return e&&(t={isBye:[2===e.p.length&&null===e.p[0]&&null!==e.p[1]&&(e.w===e.p[1]||0===e.w),(1===e.p.length||2===e.p.length&&null===e.p[1])&&null!==e.p[0]&&(e.w===e.p[0]||0===e.w)],isPlayed:null!==e.w,winnerIdx:null},t.isNoshow=[!t.isBye[0]&&2===e.p.length&&null!==e.p[0]&&null!==e.p[1]&&0===e.s.length&&e.w===e.p[1],!t.isBye[1]&&2===e.p.length&&null!==e.p[0]&&null!==e.p[1]&&0===e.s.length&&e.w===e.p[0]],t.isDoubleNoshow=!t.isBye[0]&&!t.isBye[1]&&2===e.p.length&&null!==e.p[0]&&null!==e.p[1]&&0===e.s.length&&0===e.w,t.isBye[1]&&0===e.w&&(t.isNoshow[0]=!0),t.isBye[0]&&0===e.w&&(t.isNoshow[1]=!0),t.isDoubleNoshow&&(t.isNoshow[0]=!0,t.isNoshow[1]=!0),t.defined=2===e.p.length&&null!==e.p[0]&&null!==e.p[1]||t.isBye[0]||t.isBye[1],e.p[0]&&null!==e.w&&e.p[0]===e.w?t.winnerIdx=0:e.p[1]&&null!==e.w&&e.p[1]===e.w?t.winnerIdx=1:!e.p[0]||null===e.w||t.isNoshow[0]||t.isBye[0]||!t.isBye[1]&&!t.isNoshow[1]?!e.p[1]||null===e.w||t.isNoshow[1]||t.isBye[1]||!t.isBye[0]&&!t.isNoshow[0]||(t.winnerIdx=1):t.winnerIdx=0),t}function l(e){e.config=Object.assign({},{show_seeded:!1,noshow_icon:null,bracket_callback:null,match_cbk_selector:".brk-match-wrapper:not(.brk-undef) .brk-match",player_callback:null,player_cbk_selector:'.brk-match-player:not([data-pid=""])',extra_info:!1},e.config||{});const l=Math.ceil(Math.log2(e.members.length));e.container.innerHTML="",e.container.insertAdjacentHTML("afterbegin",'<div class="brk-outer-wrapper">\n      <div class="brk-container">\n        <div class="brk-wrapper"></div>\n      </div>\n    </div>');const s=e.container.querySelector(".brk-wrapper"),i=t({num_iscritti:e.members.length}),a=t=>{let r=o(t),l=`Round ${t.r} / Match ${t.m}`;const s=[0,1].map((n=>{let o={p:t.p[n]?e.members.filter((e=>+e.id===t.p[n]))[0]:null,tds:"",title:""};return e.config.show_seeded&&o.p&&null!==o.p?.ts&&(o.tds=`<span class="brk-seeded">${o.p.ts}</span> `),r.defined&&(o.p?o.title=o.p.n+(r.isNoshow[n]?" (no show)":""):o.title="[bye]"),o}));r.defined&&(l+=": "+[s[0].title,s[1].title].join(s[0].p&&s[1].p?" vs ":" / "));let a=[];r.isPlayed&&a.push("brk-played"),r.isBye[0]?a.push("bye1"):r.isBye[1]?a.push("bye2"):r.isDoubleNoshow?a.push("no-show1","no-show2"):r.isNoshow[0]?a.push("no-show1"):r.isNoshow[1]&&a.push("no-show2");let c=[];if(e.config.extra_info){const l=n(t,i),s=o(e.matches.filter((e=>e.m===l.child_match))[0]);r.defined||a.push("brk-undef"),s.isPlayed&&a.push("brk-cm-played"),c=[`data-cm="${l.child_match}"`]}const d=r.isBye[0]||r.isNoshow[0]||r.isBye[1]||r.isNoshow[1],u=s.map(((n,o)=>{let l=r.isBye[o],s=r.isNoshow[o],i=0===o?"one":"two";return`<div class="brk-match-player ${i} ${r.winnerIdx===o?"winner":""}" data-pid="${n.p?.id??""}">\n          <div>\n            ${s&&e.config.noshow_icon?e.config.noshow_icon:""}\n            ${n.tds}${l?"Bye":n.p?.n??""}\n          </div>\n        </div>\n        <div class="brk-match-score ${i} ${r.winnerIdx===o?"winner":""}">\n          \n          ${t.s[o]??(d?"&ndash;":"")}\n        </div>`}));return`<div class="brk-match-wrapper ${a.join(" ")}"\n          data-p="${t.p.filter((e=>null!==e)).join(" ")}" role="banner">\n        <div class="brk-connector rear" aria-hidden="true"></div>\n        <div class="brk-match" title="${l}" data-m="${t.m}" ${c.join(" ")}>\n          <div class="brk-match-idx"><span>${t.m}</span></div>\n          ${u.join("")}\n        </div>\n        <div class="brk-connector front" aria-hidden="true"></div>\n      </div>`};e.matches.sort(((e,t)=>e.m-t.m));for(let t=1;t<=l;t++){let n=r(t,l);n=n?`Round ${t}<br><strong>${n}</strong>`:`Round ${t}`;let o=e.matches.filter((e=>+e.r===t));s.insertAdjacentHTML("beforeend",`<div class="brk-round-wrapper">\n        <div class="brk-round-header">${n}</div>\n        <div class="brk-round-inner-wrapper" data-r="${t}">\n          ${o.map(a).join("")}\n        </div>\n      </div>`)}e.config.player_callback&&e.config.player_cbk_selector&&"function"==typeof e.config.player_callback?s.querySelectorAll(e.config.player_cbk_selector).forEach((t=>{t.classList.add("brk-has-cbk"),t.addEventListener("click",(()=>{e.config.player_callback(t)}),!1)})):e.config.match_callback&&e.config.match_cbk_selector&&"function"==typeof e.config.match_callback&&s.querySelectorAll(e.config.match_cbk_selector).forEach((t=>{t.classList.add("brk-has-cbk"),t.addEventListener("click",(()=>{e.config.match_callback(t)}),!1)})),function(e){let t={top:0,left:0,x:0,y:0};const n=function(n){const r=n.clientX-t.x,o=n.clientY-t.y;e.scrollTop=t.top-o,e.scrollLeft=t.left-r},r=function(){e.removeEventListener("mousemove",n),e.removeEventListener("mouseup",r),e.style.cursor="grab",e.style.removeProperty("user-select")};e.addEventListener("mousedown",(function(o){e.style.cursor="grabbing",e.style.userSelect="none",t={left:e.scrollLeft,top:e.scrollTop,x:o.clientX,y:o.clientY},e.addEventListener("mousemove",n),e.addEventListener("mouseup",r)}))}(e.container.querySelector(".brk-container")),function(e,t){e.insertAdjacentHTML("beforeend",`<div class="brk-nav-outer">\n      <div class="brk-nav-trigger" role="button" aria-label="Navigazione rounds" aria-controls="brk-nav-menu">\n        ${"<span></span>".repeat(3)}\n      </div>\n    </div>\n    <nav id="brk-nav-menu" class="brk-nav-menu"></nav>`);let n=e.querySelector(".brk-nav-menu"),r=e.querySelector(".brk-nav-trigger");for(let e=1;e<=t;e++)n.insertAdjacentHTML("beforeend",`<button class="brk-nav-item" type="button" data-r="${e}" aria-label="Vai al round ${e}">Round ${e}</button>`);r.addEventListener("click",(()=>{r.classList.toggle("open"),n.classList.toggle("show")}),!1),n.querySelectorAll(".brk-nav-item").forEach((t=>{t.addEventListener("click",(()=>{e.querySelector(`.brk-round-inner-wrapper[data-r="${t.dataset.r}"] .brk-match`).scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),n.classList.remove("show"),r.classList.remove("open")}),!1)})),document.body.addEventListener("click",(e=>{e.target.closest(".brk-nav-menu")||e.target===r||e.target.closest(".brk-nav-trigger")||!r.classList.contains("open")||r.click()}),!1),document.body.addEventListener("keydown",(function(e){"Escape"===e.key&&r.classList.contains("open")&&r.click()}),!0)}(e.container.querySelector(".brk-outer-wrapper"),l)}(()=>{const r=document.getElementById("json-partite"),o=document.getElementById("json-iscritti");let s={},i={},a=[],c=[];const d={noshow_icon:'<img src="/demo/icone-demo/noshow.svg" class="brk-noshow-icon" alt="noshow icon">',match_callback:e=>{const t=e.dataset;alert(`Match ${t.m}`)}},u=document.getElementById("num-iscritti"),m=document.getElementById("num-match"),h=document.getElementById("num-tds"),p=document.getElementById("show-tds"),g=document.querySelector(".primo-round"),f=document.querySelector(".gioca-round"),b=function(){s=function(e=12,t=2,n=4,r=!0){let o=[];for(let n=0;n<t;n++){let t=[];for(let n=0;n<2;n++){let n;for(;t.length<2;)n=Math.ceil(Math.random()*e),-1===o.concat(t).flat().indexOf(n)&&t.push(n)}o.push(t)}let l=[];for(let t=1;t<=e;t++){let n=t+" Nickname";t%5==0&&(n=`${t} long long long long nickame`),n+=t===e?" *** ultimo":"",l.push({id:t,n:n,rk:Math.floor(100*Math.random()),ts:null})}let s=0;for(;s<n;){let e=Math.floor(Math.random()*l.length);-1===o.flat().indexOf(l[e].id)&&null===l[e].ts&&(l[e].ts=++s)}const i=Math.ceil(Math.log2(e)),a={show_seeded:r};let c=Math.pow(2,i);return{stats:[`<ul>\n      <li>totale iscritti: <strong>${e}</strong></li>\n      <li>players richiesti round 1: <strong>${c}</strong></li>\n      <li>totale partire round 1 round 1: <strong>${c/2}</strong></li>\n      <li>round totali: <strong>${i}</strong></li>\n      <li>partite round 1 con bye: <strong>${c-l.length}</strong></li>\n      <li>Match personalizzati: <strong>${o.length}</strong></li>\n    </ul>`],demo_params:{num_iscritti:e,num_tds:n,custom_matches:o},config:a,members:l,matches:[]}}(+u.value,+m.value,+h.value,p.checked),t({num_iscritti:+u.value}),document.getElementById("json-parametri-demo").innerHTML=`\n      <div id="stats" class="stats"></div>\n      <h4>Parametri dati demo</h4>\n      <div class="json">${e(s.demo_params)}</div>\n      <h4>Parametri torneo</h4>\n      <div class="json">${e(s.config)}</div>\n    `,document.getElementById("stats").innerHTML=s.stats.join(""),o.innerHTML=e(c.length?c:s.members),r.innerHTML=e(a.length?a:s.matches),i={container:document.getElementById("bracket-demo-container"),members:c.length?c:s.members,matches:a.length?a:s.matches,config:{...d,...s.config}},l(i)};if(document.querySelector(".genera-dati").addEventListener("click",(()=>{u.checkValidity()&&m.checkValidity()&&h.checkValidity()?+h.value>Math.floor(+u.value/2)?alert("Il numero delle Teste di Serie deve essere una potenza di due e deve essere minore della metà degli iscritti"):(a=[],localStorage.removeItem("demo_matches"),c=[],localStorage.removeItem("demo_members"),b(),g.disabled=!1,f.disabled=!0,localStorage.setItem("demo_params",JSON.stringify({input_num_iscritti:u.value,input_num_match_pers:m.value,input_num_tds:h.value,input_show_tds:p.checked}))):alert("Errore nei parametri")}),!1),g.addEventListener("click",(()=>{a=function(e={members:[],custom_matches:[]}){const r=t({num_iscritti:(e=Object.assign({},{members:[],custom_matches:[]},e)).members.length});let o=r.num_bye,l=0;e.custom_matches.length&&(l=e.custom_matches.filter((e=>1===e.length)).length,o-=l);let s=Array(r.matches_round1),i=e.members.slice(0);i.sort(((e,t)=>{let n=(null===e.ts)-(null===t.ts)||e.ts-t.ts,r=t.rk-e.rk;return n||r}));const a=i.filter((e=>null!==e.ts)).length;if(Math.log2(a)%1!=0)throw new Error("Le TdS non sono un potenza di 2");let c={};const d=(e,t,o,l)=>{const s=n({m:t,r:e},r);return l&&(c[s.child_match]||(c[s.child_match]=[]),c[s.child_match][t%2!=0?0:1]=l),{r:e,m:t,p:o,s:[],w:l,child_match:s.child_match}},u=function(e=0,t=0){let n=1,r=[];if(e&&t){const o=e/t,l={2:[1,2],4:[1,4,3,2],8:[1,8,5,4,3,6,7,2],16:[1,16,8,9,5,12,4,13,6,11,3,14,7,10,15,2],32:[1,32,17,16,9,24,25,8,5,28,21,12,13,20,29,4,3,30,19,14,11,22,27,6,7,26,23,10,15,18,31,2],64:[1,64,33,32,17,48,49,16,9,56,41,24,25,40,57,8,5,60,37,28,21,44,53,12,13,52,45,20,29,36,61,4,3,62,35,30,19,46,51,14,11,54,43,22,27,38,59,6,7,58,39,26,23,42,55,10,15,50,47,18,31,34,63,2]};for(let e=0;e<t;e++)e===t/2&&(n+=o-1),r.push({tds:l[t][e],match_id:n}),n+=o}return r}(r.matches_round1,a);let m=0;const h=(e,t=null,n=!1)=>{let r;if(m<a){let n=[e,t].filter((e=>null!==e&&null!==e.ts));n.length&&(r=u.filter((e=>e.tds===n[0].ts))[0].match_id,m++)}if(void 0===r){let e;if(n){let t=[...s].map(((e,t)=>void 0===e?t:null)).filter((e=>null!==e));if(!t.length)throw new Error("addMatchRound1: nessun slot vuoto disponibile (random_match)");e=t[Math.floor(Math.random()*t.length)]}else if(e=s.findIndex((e=>void 0===e)),-1===e)throw new Error("addMatchRound1: nessun slot vuoto disponibile");r=e+1}s[r-1]=d(1,r,[e.id,t?t.id:null],null!==t?null:e.id)};if(i.filter((e=>null!==e.ts)).forEach((t=>{if(-1===e.custom_matches.flat().indexOf(t.id)){let e;o?(e=null,o--):(e=i.filter((e=>null===e.ts)).slice(-1)[0],i.splice(i.findIndex((t=>t.id===e.id)),1)),i.splice(i.findIndex((e=>e.id===t.id)),1),h(t,e||null)}})),o+=l,e.custom_matches.forEach((e=>{let t=[];if(e.forEach((e=>{t.push(i.splice(i.findIndex((t=>t.id===e)),1)[0])})),2===t.length&&null!==t[0].ts&&null!==t[1].ts)throw new Error(`addMatchRound1: custom match con due TdS (#${t[0].id} “${t[0].n}” vs #${t[1].id} “${t[1].n}”)`);if(1===t.length){if(o<=0)throw new Error(`custom matches: Bye non disponibile (match con #${t[0].id} “${t[0].n}”)`);o--,t.push(null)}h(...t,!0)})),i.splice(0,o).forEach((e=>{h(e,null,!0)})),i=function(e){for(var t,n=e.length;0!==n;)t=Math.floor(Math.random()*n),n--,[e[n],e[t]]=[e[t],e[n]];return e}(i),i.length%2!=0)throw new Error("Il numero di iscritti risultante dalle precedenti elaborazioni non è pari");if(i.length&&i.forEach(((e,t)=>{t%2==0&&h(e,i[t+1])})),s.length!==r.matches_round1)throw new Error(`Sono presenti ${s.length} partite invece di ${r.matches_round1}`);if(-1!==s.findIndex((e=>void 0===e)))throw new Error("Sono presenti partite non definite");let p=r.matches_round1,g=p,f=p+1;for(let e=2;e<=r.num_rounds;e++){p/=2,g+=p;for(let t=f;t<=g;t++)c[t]&&(c[t][0]??=null,c[t][1]??=null),s.push(d(e,t,c[t]?c[t]:[],null));f+=p}return s}({members:s.members,custom_matches:s.demo_params.custom_matches}),i.matches=a,l(i),localStorage.setItem("demo_matches",JSON.stringify(a)),localStorage.setItem("demo_members",JSON.stringify(s.members)),r.innerHTML=e(a),g.disabled=!0,f.disabled=!1}),!1),document.querySelector(".acquisisci-box-dati").addEventListener("click",(()=>{c=JSON.parse(o.innerText.replace(/(\w+):/g,'"$1":')),a=JSON.parse(r.innerText.replace(/(\w+):/g,'"$1":')),localStorage.setItem("demo_matches",JSON.stringify(a)),localStorage.setItem("demo_members",JSON.stringify(c)),i.members=c,i.matches=a,l(i)}),!1),localStorage.demo_params){const e=JSON.parse(localStorage.demo_params);u.value=e.input_num_iscritti,m.value=e.input_num_match_pers,h.value=e.input_num_tds,p.checked=e.input_show_tds}localStorage.demo_members&&(c=JSON.parse(localStorage.demo_members)),localStorage.demo_matches&&(a=JSON.parse(localStorage.demo_matches),g.disabled=!0,f.disabled=!1),b()})()}();
//# sourceMappingURL=single-elimination-demo.min.js.map
